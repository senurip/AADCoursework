<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Packages</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
          href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap"
          rel="stylesheet">

  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <link href="../assets/css/main.css" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    .course-card {
      transition: transform 0.3s, box-shadow 0.3s;
      margin-bottom: 20px;
      display: flex;
      /* Enable flexbox for the card */
      flex-direction: column;
      /* Stack card content vertically */
      height: 100%;
      /* Ensure card takes full height of its container */
    }

    .course-card:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .course-image {
      height: 300px;
      object-fit: cover;
    }

    .course-price {
      font-weight: bold;
      color: black;
    }

    .card-title {
      font-size: xx-large;
    }

    .enroll-btn {
      color: white;
      padding: 8px 35px 10px 35px;
      background: #16819c;
      display: inline-block;
      border-radius: 10px;
      font-size: 14px;
      font-family: "Raleway", sans-serif;
      font-weight: 600;
    }

    .card-body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      /* Add this line */
      flex-grow: 1;
      /* Allow body to take up available space */
    }

    .card-footer {
      margin-top: auto;
      /* Push footer to the bottom */
      padding-top: 1rem;
      border-top: 1px solid #dee2e6;
    }

    /* Add this style to make the cards display in a row */
    #packages-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    #packages-container .col-md-4 {
      flex: 0 0 calc(33.33% - 20px);
      /* 3 cards per row with spacing */
      max-width: calc(33.33% - 20px);
    }

    @media (max-width: 992px) {
      #packages-container .col-md-4 {
        flex: 0 0 calc(50% - 20px);
        /* 2 cards per row on medium screens */
        max-width: calc(50% - 20px);
      }
    }

    @media (max-width: 768px) {
      #packages-container .col-md-4 {
        flex: 0 0 100%;
        /* 1 card per row on small screens */
        max-width: 100%;
      }
    }
  </style>

</head>

<body class="courses-page">

<header id="header" class="header d-flex align-items-center sticky-top">
  <div class="container-fluid container-xl position-relative d-flex align-items-center">

    <a href="index.html" class="logo d-flex align-items-center me-auto">
      <h1 class="sitename"><img src="../assets/img/CEElogo.png">
        <h1>CEE </h1>
      </h1>
    </a>

    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="index.html">Home<br></a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="packages.html" class="active">Packages</a></li>
        <li><a href="blogs.html">Blogs</a></li>
        <li id="admin-nav" style="display: none;"><a href="admin.html">Admin</a></li>
        <li id="profile-nav" style="display: none;"><a href="profile.html">Profile</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </nav>

    <div class="auth-container">
      <a class="btn-getstarted" id="sign-in-button" href="login.html">Sign In</a>
      <div class="user-profile" id="user-profile" style="display: none;">
        <span class="btn-getstarted" id="user-name">User Name</span>
        <a class="btn-get-started" id="logout-button" href="#">Logout</a>
      </div>
    </div>

  </div>
</header>

<main class="main">

  <div class="page-title" data-aos="fade">
    <div class="heading">
      <div class="container">
        <div class="row d-flex justify-content-center text-center">
          <div class="col-lg-8">
            <h1>Packages </h1>
            <p class="mb-0">Discover tailor-made travel packages designed to showcase the beauty of
              Ceylon. Whether it's a beach escape, mountain adventure, or cultural exploration, we
              have the perfect itinerary for you.</p>
          </div>
        </div>
      </div>
    </div>
    <nav class="breadcrumbs">
      <div class="container">
        <ol>
          <li><a href="index.html">Home</a></li>
          <li class="current">Packages</li>
        </ol>
      </div>
    </nav>
  </div>
  <section id="packages-section" class="courses section">
    <div class="container section-title" data-aos="fade-up">
      <h2>Packages</h2>
      <p>Popular Packages</p>
    </div>
    <div class="container py-5">
      <div id="packages-container" class="row">
      </div>
    </div>
  </section>

</main>

<div class="modal fade" id="packageDetailsModal" tabindex="-1" aria-labelledby="packageDetailsModalLabel"
     aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="packageDetailsModalLabel">Package Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 id="modal-package-title"></h5>
        <p id="modal-package-description"></p>
        <p><strong>Price: $<span id="modal-package-price"></span></strong></p>
        <div id="payment-options">
          <form id="payhere-form" method="POST" action="https://sandbox.payhere.lk/pay/checkout"
                style="display: none;">
            <input type="hidden" name="merchant_id" id="merchant_id">
            <input type="hidden" name="return_url"
                   value="http://localhost:8080/api/v1/payments/return">
            <input type="hidden" name="cancel_url"
                   value="http://localhost:8080/api/v1/payments/cancel">
            <input type="hidden" name="notify_url"
                   value="https://fb4a-2402-4000-20c3-215d-ecb2-7334-3438-b532.ngrok-free.app/api/v1/payments/notify">
            <input type="hidden" name="order_id" id="order_id">
            <input type="hidden" name="items" id="items">
            <input type="hidden" name="currency" id="currency" value="LKR">
            <input type="hidden" name="amount" id="amount">
            <input type="hidden" name="first_name" id="first_name">
            <input type="hidden" name="last_name" id="last_name">
            <input type="hidden" name="email" id="email">
            <input type="hidden" name="phone" id="phone">
            <input type="hidden" name="address" id="address">
            <input type="hidden" name="city" id="city">
            <input type="hidden" name="country" value="LK">
            <input type="hidden" name="hash" id="hash">
          </form>
          <button id="pay-button" class="btn btn-success">Proceed to Payment</button>
        </div>
      </div>
    </div>
  </div>
</div>

<footer id="footer" class="footer position-relative light-background">

  <div class="container footer-top">
    <div class="row gy-4">
      <div class="col-lg-4 col-md-6 footer-about">
        <a href="index.html" class="logo d-flex align-items-center">
          <span class="sitename">CEE</span>
        </a>
        <div class="footer-contact pt-3">
          <p>A108 Adam Street</p>
          <p>New York, NY 535022</p>
          <p class="mt-3"><strong>Phone:</strong> <span>+1 5589 55488 55</span></p>
          <p><strong>Email:</strong> <span>info@example.com</span></p>
        </div>
        <div class="social-links d-flex mt-4">
          <a href=""><i class="bi bi-twitter-x"></i></a>
          <a href=""><i class="bi bi-facebook"></i></a>
          <a href=""><i class="bi bi-instagram"></i></a>
          <a href=""><i class="bi bi-linkedin"></i></a>
        </div>
      </div>

      <div class="col-lg-2 col-md-3 footer-links">
        <h4>Useful Links</h4>
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">About us</a></li>
          <li><a href="#">Services</a></li>
          <li><a href="#">Terms of service</a></li>
          <li><a href="#">Privacy policy</a></li>
        </ul>
      </div>

      <div class="col-lg-2 col-md-3 footer-links">
        <h4>Our Services</h4>
        <ul>
          <li><a href="#">Travel Planning</a></li>
          <li><a href="#">Hotel Listings</a></li>
          <li><a href="#">Dining Recommendations</a></li>
          <li><a href="#">Tour Partnerships</a></li>
          <li><a href="#">Promote your packages</a></li>
        </ul>
      </div>

      <div class="col-lg-4 col-md-12 footer-newsletter">
        <h4>Our Newsletter</h4>
        <p>Subscribe to our newsletter and receive the latest news about our products and services!</p>
        <form action="../forms/newsletter.php" method="post" class="php-email-form">
          <div class="newsletter-form"><input type="email" name="email"><input type="submit"
                                                                               value="Subscribe"></div>
          <div class="loading">Loading</div>
          <div class="error-message"></div>
          <div class="sent-message">Your subscription request has been sent. Thank you!</div>
        </form>
      </div>

    </div>
  </div>

  <div class="container copyright text-center mt-4">
    <p>Â© <span>Copyright</span> <strong class="px-1 sitename">CEE</strong> <span>All Rights Reserved</span></p>
    <div class="credits">
      Designed by <a href="https://www.linkedin.com/in/senuri-rajapaksha-0a9584290/">SR</a>
    </div>
  </div>

</footer>

<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
        class="bi bi-arrow-up-short"></i></a>

<div id="preloader"></div>

<script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../assets/vendor/php-email-form/validate.js"></script>
<script src="../assets/vendor/aos/aos.js"></script>
<script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="../assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>

<script src="../assets/js/main.js"></script>

<script src="../script/nav.js"></script>

<script>
  $(document).ready(function () {
    const BASE_URL = 'http://localhost:8080';
    var accessToken = localStorage.getItem('userToken');
    var userId = localStorage.getItem('userId');

    function loadPackages() {
      $.ajax({
        url: `${BASE_URL}/api/v1/packages/all`,
        method: 'GET',
        dataType: 'json',
        success: function (response) {
          console.log(response);
          const packagesContainer = $('#packages-container');
          packagesContainer.empty();

          response.packageList.forEach(function (pkg) {
            const packageCard = `
              <div class="col-md-4">
                <div class="card course-card">
                  <img src="http://localhost:8080${pkg.imgUrl}" class="card-img-top course-image" alt="${pkg.title}">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h5 class="card-title m-0">${pkg.title}</h5>
                      <span class="course-price">LKR ${pkg.price.toFixed(2) || '0.00'}</span>
                    </div>
                    <p class="card-text text-muted">${pkg.description}</p>
                  </div>
                  <div class="card-footer">
                    <button class="btn btn-light btn-sm enroll-btn"
                            data-package-id="${pkg.id}"
                            data-package-title="${pkg.title}"
                            data-package-description="${pkg.description}"
                            data-package-price="${pkg.price}">
                      Book Now
                    </button>
                  </div>
                </div>
              </div>
            `;
            packagesContainer.append(packageCard);
          });

          $('.enroll-btn').on('click', function () {
            const packageId = $(this).data('package-id');
            const packageTitle = $(this).data('package-title');
            const packageDescription = $(this).data('package-description');
            const packagePrice = $(this).data('package-price');

            $('#modal-package-title').text(packageTitle);
            $('#modal-package-description').text(packageDescription);
            $('#modal-package-price').text(packagePrice);

            // Show the modal
            $('#packageDetailsModal').modal('show');

            // Handle PayHere form submission when the user clicks "Proceed to Payment"
            $('#pay-button').off('click').on('click', function () {
              initiatePayment(packageId, packagePrice, packageTitle);
            });
          });
        },
        error: function (xhr, status, error) {
          console.error('Error loading packages:', error);
          $('#packages-container').html(`
            <div class="col-12">
              <div class="alert alert-danger">
                Unable to load packages. Please try again later.
              </div>
            </div>
          `);
        }
      });
    }

    function initiatePayment(packageId, amount, item) {
      $.ajax({
        url: `${BASE_URL}/api/v1/payments/initiate`,
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + accessToken
        },
        data: {
          userId: userId,
          packageId: packageId
        },
        success: function (response) {
          if (response.statusCode === 200) {
            const payment = response.payment;

            // Populate PayHere form fields
            $('#merchant_id').val(payment.merchantId);
            $('#order_id').val(payment.orderId);
            $('#items').val(item);
            $('#amount').val(amount);
            $('#first_name').val(localStorage.getItem('firstName'));
            $('#last_name').val(localStorage.getItem('lastName'));
            $('#email').val(localStorage.getItem('email'));
            $('#phone').val(localStorage.getItem('phone'));
            $('#address').val(localStorage.getItem('address'));
            $('#city').val(localStorage.getItem('city'));
            $('#hash').val(payment.hash);

            // Submit the form to PayHere
            $('#payhere-form').submit();
          } else {
            alert('Error initiating payment: ' + response.message);
          }
        },
        error: function (xhr, status, error) {
          // console.error('Error initiating payment:', error);
          // alert('Failed to initiate payment');
          window.location.href = 'login.html';
        }
      });
    }

    loadPackages();
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</body>

</html>
